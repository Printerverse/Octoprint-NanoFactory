<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>

</body>

<script defer src="./index.e3d13bdc.js" />


<script type="text/javascript" />

/* const handleJob=async (data, peerID, label, metadata)=> {
switch (label) {
case "13":
// jobCreated
metadata = JSON.parse(metadata)
let myHeaders = new Headers()
myHeaders.append("X-API-KEY", APIKEY)

let fileContent = new TextDecoder("utf-8").decode(data)
let fileBlob = new Blob([fileContent], { type: "text/plain;charset=utf-8" })
let file = new File([fileBlob], metadata["jobName"] + ".gcode")

let formData = new FormData()
formData.append("file", file, metadata["jobName"] + ".gcode")
formData.append("print", true);

let response = await fetch("http://localhost:5000/api/files/local", {
method: 'POST',
headers: myHeaders,
body: formData
})

console.log(await response.json())

// jobPrinting
sendData(peerID, {
"data": {
"id": metadata["id"],
"startTime": new Date().toISOString(),
}
}, "37")



sendJobProgress(peerID)
break;
}
}

const sendJobProgress = (peerID) => {

// currentJobUpdates
const label = "49"

const options = {
label: label,
metadata: peerID,
serialization: "json",
reliable: true,
}

jobProgressConnection = peer.connect(peerID, options);

jobProgressConnection.on("open", function () {
// jobProgressConnection.send(data);
console.log("jobProgress connection is open " + peerID)
setInterval(pollProgress, 10000, 10000)
});

jobProgressConnection.on("error", function () {
jobProgressConnection = peer.connect(peerID, options);
})

}

const pollProgress = async () => {

payload = {
"data": {
"progress": null
}
}

payload["data"]["progress"] = (await (await fetch("http://localhost:5000/api/job", {
method: "GET",
headers: {
"X-API-KEY": APIKEY
}
})).json())["progress"]["completion"]

//console.log(payload)

jobProgressConnection.send(JSON.stringify(payload))
}

* /
</script>

</html>